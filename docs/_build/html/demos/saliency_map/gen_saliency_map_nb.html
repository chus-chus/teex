<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generating image data with g.t. saliency maps &mdash; teex 1.0.4 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Evaluation of explanation quality: saliency maps" href="eval_saliency_map_nb.html" />
    <link rel="prev" title="Saliency map" href="saliency_map.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> teex
            <img src="../../_static/rsz_teex_logo__.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Notebook demos</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="saliency_map.html">Saliency map</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Generating image data with g.t. saliency maps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#1.-Generating-synthetic-images">1. Generating synthetic images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#2.-Exploring-the-images">2. Exploring the images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3.-Exploring-a-white-box-model">3. Exploring a white-box model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4.-Loading-Kahikata-image-data">4. Loading Kahikata image data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="eval_saliency_map_nb.html">Evaluation of explanation quality: saliency maps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../decision_rule/decision_rule.html">Decision rule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../feature_importance/feature_importance.html">Feature importance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../word_importance/word_importance.html">Word importance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model_selection/model_selection.html">Model selection</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/modules.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">teex</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../examples.html">Notebook demos</a> &raquo;</li>
          <li><a href="saliency_map.html">Saliency map</a> &raquo;</li>
      <li>Generating image data with g.t. saliency maps</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/demos/saliency_map/gen_saliency_map_nb.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Generating-image-data-with-g.t.-saliency-maps">
<h1>Generating image data with g.t. saliency maps<a class="headerlink" href="#Generating-image-data-with-g.t.-saliency-maps" title="Permalink to this heading"></a></h1>
<p>Let’s explore the ‘seneca’ method for generating artificial images with available ground truth saliency maps. It was presented in <a class="reference external" href="https://www.researchgate.net/publication/346916247_Evaluating_local_explanation_methods_on_ground_truth">Evaluating local explanation methods on ground truth, Riccardo Guidotti, 2021</a>, and although the original intention of the paper was not to present an artificial data generator, it can serve our purpose.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">teex</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">floor</span>
</pre></div>
</div>
</div>
<section id="1.-Generating-synthetic-images">
<h2>1. Generating synthetic images<a class="headerlink" href="#1.-Generating-synthetic-images" title="Permalink to this heading"></a></h2>
<p>Let’s generate artificial image data with the ‘seneca’ method. In this case, the generated images are composed of squared cells of a fixed size and randomly colored as (almost) Red, Green or Blue. A number of these images contain a randomly generated pattern such that the ones that do so are labeled as ‘1’ and the ones that are not are labeled as ‘0’. If an image contains the pattern, then the ground truth explanation is a binary mask of the same dimensions where the pattern is highlighted. The
user can control:</p>
<ul class="simple">
<li><p>Image width and height, in pixels</p></li>
<li><p>Image cell width and height, in pixels and divisor of image width and height</p></li>
<li><p>The proportion of the image that should be filled with cells (fillPct)</p></li>
<li><p>Pattern height and width, in pixels. The number of pixels the randomly generated pattern will take (divisor of image width and height). The previous parameter ‘fillPct’ also specifies the number of cells filled in the pattern.</p></li>
<li><p>The percentage of images that contain the pattern ‘patternProp’</p></li>
<li><p>colorDev: [0, 0.5] If 0, each cell will be completely red, green or blue. The greater (max 0.5), the more mixed will colored channels be. Adds complexity to the task of classification.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">teex.saliencyMap.data</span> <span class="kn">import</span> <span class="n">SenecaSM</span>

<span class="n">nSamples</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">randomState</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">imageH</span><span class="p">,</span> <span class="n">imageW</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span>
<span class="n">patternH</span><span class="p">,</span> <span class="n">patternW</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span>
<span class="n">cellH</span><span class="p">,</span> <span class="n">cellW</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span>
<span class="n">patternProp</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">fillPct</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">colorDev</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">dataGen</span> <span class="o">=</span> <span class="n">SenecaSM</span><span class="p">(</span><span class="n">nSamples</span><span class="o">=</span><span class="n">nSamples</span><span class="p">,</span> <span class="n">imageH</span><span class="o">=</span><span class="n">imageH</span><span class="p">,</span> <span class="n">imageW</span><span class="o">=</span><span class="n">imageW</span><span class="p">,</span>
                         <span class="n">patternH</span><span class="o">=</span><span class="n">patternH</span><span class="p">,</span> <span class="n">patternW</span><span class="o">=</span><span class="n">patternW</span><span class="p">,</span>
                         <span class="n">cellH</span><span class="o">=</span><span class="n">cellH</span><span class="p">,</span> <span class="n">cellW</span><span class="o">=</span><span class="n">cellW</span><span class="p">,</span> <span class="n">patternProp</span><span class="o">=</span><span class="n">patternProp</span><span class="p">,</span>
                         <span class="n">fillPct</span><span class="o">=</span><span class="n">fillPct</span><span class="p">,</span> <span class="n">colorDev</span><span class="o">=</span><span class="n">colorDev</span><span class="p">,</span> <span class="n">randomState</span><span class="o">=</span><span class="n">randomState</span><span class="p">)</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">exps</span> <span class="o">=</span> <span class="n">dataGen</span><span class="p">[:]</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">dataGen</span><span class="o">.</span><span class="n">pattern</span>
</pre></div>
</div>
</div>
<p><strong>X</strong> contains the generated images, <strong>y</strong> the labels, <strong>exps</strong> the ground truth explanations and <strong>pat</strong> the exact pattern contained by the images.</p>
</section>
<section id="2.-Exploring-the-images">
<h2>2. Exploring the images<a class="headerlink" href="#2.-Exploring-the-images" title="Permalink to this heading"></a></h2>
<p>Some of the generated images contain the following pattern:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x142066cd0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/demos_saliency_map_gen_saliency_map_nb_9_1.png" src="../../_images/demos_saliency_map_gen_saliency_map_nb_9_1.png" />
</div>
</div>
<p>For example, the first one, which is labeled as</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x1424ee7f0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/demos_saliency_map_gen_saliency_map_nb_11_2.png" src="../../_images/demos_saliency_map_gen_saliency_map_nb_11_2.png" />
</div>
</div>
<p>contains it</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">exps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x142b78a60&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/demos_saliency_map_gen_saliency_map_nb_13_1.png" src="../../_images/demos_saliency_map_gen_saliency_map_nb_13_1.png" />
</div>
</div>
<p>for a more clear view:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plt_imgs</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">exp</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pattern&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Generated image&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Explanation&#39;</span><span class="p">)</span>

<span class="n">plt_imgs</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">exps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/demos_saliency_map_gen_saliency_map_nb_15_0.png" src="../../_images/demos_saliency_map_gen_saliency_map_nb_15_0.png" />
</div>
</div>
<p>Not all images have the pattern in the same position:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt_imgs</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">exps</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/demos_saliency_map_gen_saliency_map_nb_17_0.png" src="../../_images/demos_saliency_map_gen_saliency_map_nb_17_0.png" />
</div>
</div>
<p>We can generate images with another pattern by changing the random state</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataGen</span> <span class="o">=</span> <span class="n">SenecaSM</span><span class="p">(</span><span class="n">nSamples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">imageH</span><span class="o">=</span><span class="n">imageH</span><span class="p">,</span> <span class="n">imageW</span><span class="o">=</span><span class="n">imageW</span><span class="p">,</span>
                  <span class="n">patternH</span><span class="o">=</span><span class="n">patternH</span><span class="p">,</span> <span class="n">patternW</span><span class="o">=</span><span class="n">patternW</span><span class="p">,</span>
                  <span class="n">cellH</span><span class="o">=</span><span class="n">cellH</span><span class="p">,</span> <span class="n">cellW</span><span class="o">=</span><span class="n">cellW</span><span class="p">,</span> <span class="n">patternProp</span><span class="o">=</span><span class="n">patternProp</span><span class="p">,</span>
                  <span class="n">fillPct</span><span class="o">=</span><span class="n">fillPct</span><span class="p">,</span> <span class="n">colorDev</span><span class="o">=</span><span class="n">colorDev</span><span class="p">,</span> <span class="n">randomState</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">exps</span> <span class="o">=</span> <span class="n">dataGen</span><span class="p">[:]</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">dataGen</span><span class="o">.</span><span class="n">pattern</span>

<span class="n">plt_imgs</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">exps</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/demos_saliency_map_gen_saliency_map_nb_19_0.png" src="../../_images/demos_saliency_map_gen_saliency_map_nb_19_0.png" />
</div>
</div>
<p>The images that do not contain a pattern have as explanation a black mask. Note that in order for the images to contain the pattern it must not only match the shape, but its colors too. We can check that we have the desired proportion of classes in the dataset:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">patternProp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>We can also check how changing the parameter colorDev affects the coloring of the images</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataGen</span> <span class="o">=</span> <span class="n">SenecaSM</span><span class="p">(</span><span class="n">nSamples</span><span class="o">=</span><span class="n">nSamples</span><span class="p">,</span> <span class="n">imageH</span><span class="o">=</span><span class="n">imageH</span><span class="p">,</span> <span class="n">imageW</span><span class="o">=</span><span class="n">imageW</span><span class="p">,</span>
                  <span class="n">patternH</span><span class="o">=</span><span class="n">patternH</span><span class="p">,</span> <span class="n">patternW</span><span class="o">=</span><span class="n">patternW</span><span class="p">,</span>
                  <span class="n">cellH</span><span class="o">=</span><span class="n">cellH</span><span class="p">,</span> <span class="n">cellW</span><span class="o">=</span><span class="n">cellW</span><span class="p">,</span> <span class="n">patternProp</span><span class="o">=</span><span class="n">patternProp</span><span class="p">,</span>
                  <span class="n">fillPct</span><span class="o">=</span><span class="n">fillPct</span><span class="p">,</span> <span class="n">colorDev</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">randomState</span><span class="o">=</span><span class="n">randomState</span><span class="p">)</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">exps</span> <span class="o">=</span> <span class="n">dataGen</span><span class="p">[:]</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">dataGen</span><span class="o">.</span><span class="n">pattern</span>

<span class="n">plt_imgs</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">exps</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/demos_saliency_map_gen_saliency_map_nb_23_0.png" src="../../_images/demos_saliency_map_gen_saliency_map_nb_23_0.png" />
</div>
</div>
<p>Indeed, the pattern and the cells that are filled in the images are the same, but the colors are different.</p>
</section>
<section id="3.-Exploring-a-white-box-model">
<h2>3. Exploring a white-box model<a class="headerlink" href="#3.-Exploring-a-white-box-model" title="Permalink to this heading"></a></h2>
<p>The ‘seneca’ method used to generate the artificial data in TAIAOexp can also return an underlying white-box model. In the case of the image data, the model can recognize if the generated pattern is contained within an observation by performing a linear scan. The models implement .fit, .predict and .predict_proba methods in order for them to easily work with explainability frameworks. We can retrieve the whitebox model by setting the parameter ‘returnModel’ to <strong>True</strong> when generating the data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataGen</span> <span class="o">=</span> <span class="n">SenecaSM</span><span class="p">(</span><span class="n">nSamples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">imageH</span><span class="o">=</span><span class="n">imageH</span><span class="p">,</span> <span class="n">imageW</span><span class="o">=</span><span class="n">imageW</span><span class="p">,</span>
                   <span class="n">patternH</span><span class="o">=</span><span class="n">patternH</span><span class="p">,</span> <span class="n">patternW</span><span class="o">=</span><span class="n">patternW</span><span class="p">,</span>
                   <span class="n">cellH</span><span class="o">=</span><span class="n">cellH</span><span class="p">,</span> <span class="n">cellW</span><span class="o">=</span><span class="n">cellW</span><span class="p">,</span> <span class="n">patternProp</span><span class="o">=</span><span class="n">patternProp</span><span class="p">,</span>
                   <span class="n">fillPct</span><span class="o">=</span><span class="n">fillPct</span><span class="p">,</span> <span class="n">colorDev</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">randomState</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">exps</span> <span class="o">=</span> <span class="n">dataGen</span><span class="p">[:]</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">dataGen</span><span class="o">.</span><span class="n">pattern</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">dataGen</span><span class="o">.</span><span class="n">transparentModel</span>  <span class="c1"># the underlying transparent model</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;teex.saliencyMap.data.TransparentImageClassifier at 0x142e7fb50&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1, 1, 0, 0, 0]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[0.0, 1.0], [0.0, 1.0], [1.0, 0.0], [1.0, 0.0], [1.0, 0.0]]
</pre></div></div>
</div>
<p>The model can also ‘explain’ instances dynamically:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">explanations</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">explanations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Generated explanation&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Corresponding image&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Corresponding image&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/demos_saliency_map_gen_saliency_map_nb_32_1.png" src="../../_images/demos_saliency_map_gen_saliency_map_nb_32_1.png" />
</div>
</div>
</section>
<section id="4.-Loading-Kahikata-image-data">
<h2>4. Loading Kahikata image data<a class="headerlink" href="#4.-Loading-Kahikata-image-data" title="Permalink to this heading"></a></h2>
<p>teex includes real datasets with available ground truth explanations. For example, the Kahikatea dataset contains 519 images, and the task is to tell whether each observation contains Kahikatea trees or not. There are 232 positive observations and 287 negative ones.</p>
<p>In teex, the non-artificial datasets are implemented as classes, similarly to PyTorch. After instancing the class, the data itself will be downloaded if it has not been used before. Once done, one can slice it to obtain observations. Each observation contains the data point, the label and the ground truth explanation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">teex.saliencyMap.data</span> <span class="kn">import</span> <span class="n">Kahikatea</span>

<span class="n">kahikateaData</span> <span class="o">=</span> <span class="n">Kahikatea</span><span class="p">()</span>
<span class="n">kData</span><span class="p">,</span> <span class="n">kLabels</span><span class="p">,</span> <span class="n">kExps</span> <span class="o">=</span> <span class="n">kahikateaData</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">kData</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Image&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">kExps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;g.t. explanation&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;g.t. explanation&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/demos_saliency_map_gen_saliency_map_nb_36_1.png" src="../../_images/demos_saliency_map_gen_saliency_map_nb_36_1.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="saliency_map.html" class="btn btn-neutral float-left" title="Saliency map" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="eval_saliency_map_nb.html" class="btn btn-neutral float-right" title="Evaluation of explanation quality: saliency maps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Chus Antonanzas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>